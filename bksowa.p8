pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
function _init()
  //screen state
  screen = 1  // game title
  //10 = gameplay
  //99 = game over

  start()
end

function start() 
  cls()

  //levels
  l = {}
  l[1] = {}
  l[1].y = 0
  l[1].pstarty = 64
  l[1].psprites = {}
  l[1].psprites[1] = 64
  l[1].psprites[2] = 66
  l[1].psprites[3] = 68
  l[1].esprite = 96
  l[2] = {}
  l[2].y = 128
  l[2].pstarty = 192
  l[2].psprites = {}
  l[2].psprites[1] = 70
  l[2].psprites[2] = 72
  l[2].psprites[3] = 74
  l[2].esprite = 98
  cl = 2 //current level
  
		//player
  p = {}
  p.x = 16 //position x
  p.y = l[cl].pstarty //position y
  p.vx = 0 //velocity x
  p.vy = 0 //velocity y
  p.sprites = l[cl].psprites
  p.cframe = 1 //current frame
  p.tslfc = 0 //last frame change
  p.state = "running" //running, jump1, jump2
  
  bg = {}
  bg.sun = {}
  bg.sun.eyey = 4
  bg.sobjects = {} //scrolling background objects
  for i=1, 15 do
    bg.sobjects[i] = {}
    bg.sobjects[i].x = (i*100) + flr(rnd(100))
    bg.sobjects[i].y = flr(rnd(70))
    bg.sobjects[i].sprite = 43 //cloud sprite
  end
  
  //enemies
  enemies = {}
  enemies.lj = 0 //last jump
  enemies.jumprate = 40
  enemies.gravity = 0.25
  for i=1, 8 do
    enemies[i] = {}
    enemies[i].x = (100 * i) + 65
    enemies[i].y = 0
    enemies[i].vy = 0
    enemies[i].vx = 0
    enemies[i].sprite = l[cl].esprite
  end
  
  //camera position
  cx=0
  
  //camera velocity
  cvx=2
  
  //draw time elapsed
  t=0
end

function _update()
  if screen == 1 then
    if btn() > 0 then
      screen = 10
    end  
  end

  if screen == 10 then
		  if btnp(2) then
		    if p.state == "running" then
		      p.state = "jump1"
		      p.vy = -6
		    elseif p.state == "jump1" then
		      p.state = "jump2"
		      p.vy = -6
		    end
		  elseif grounded(p) then
		    p.vy = 0
		    p.y = flr(flr(p.y)/8)*8
		    p.state = "running"
		  else
		    p.vy += 0.55
		  end
		  
		  p.x += min(p.vx, 2)
		  p.y += min(p.vy, 5)
		  
		  for i=1, rawlen(enemies) do
		  		local e = enemies[i]
		  		if enemies.lj > enemies.jumprate then
		  		  e.vy = -10
		  		elseif grounded(e) then
		  		  e.vy = 0
		      e.y = flr(flr(e.y)/8)*8
		  		else
        e.vy += enemies.gravity
      end
      
      e.y += min(e.vy, 5)
    end
    	
    if enemies.lj > enemies.jumprate then
      enemies.lj = 0
    end
    enemies.lj += 1
  end
end

function _draw()
  cls()
  t+=1
  
  if screen == 1 then
    drawtitlescreen()
  end
  
  if screen == 10 then  
			  drawenv()
			  p.x += cvx
			  ani(p, 2, 2, 3, 4)
	    
	    for i=1, rawlen(enemies) do
       enemies[i].vy += 0.55
       spr(l[cl].esprite, enemies[i].x, enemies[i].y, 2, 2)
     end
	  
	    cx += cvx
	    if cx > 900 then //loop the level
	      cx = 0 //reset camera
	    		p.x = 16 //reset player
		     for s in all(bg.sobjects) do //reset clouds
		       if s.x > 900 then s.x-=900 end
		     end	    		
	  		end
	  		camera(cx, l[cl].y)
  end
end

function drawenv() 
  rectfill(0,0,1050,256,1) //sky

  circfill(cx,0,15,10) //sun
  circfill(cx+5,3,2,6)
  circfill(cx+11,3,2,6)
  circfill(cx+6,bg.sun.eyey,1,1)
  circfill(cx+12,bg.sun.eyey,1,1)
  line(cx+3,7,cx+5,9,1)
  line(cx+5,9,cx+9,10,1)
		
		for s in all(bg.sobjects) do
		  s.x += .25
		  spr(s.sprite, s.x, s.y, 2, 2)  
		  if s.x < 0 then s.x=1000 end
		end
		
		map(0, 0, 0, 0, 128, 48)
end

function ani(n,w,h,frames,speed)
  if n.tslfc > speed then
    n.cframe+=1
    if n.cframe > rawlen(n.sprites) then
      n.cframe=1
    end 
    n.tslfc=0
  end
  spr(n.sprites[n.cframe], n.x, n.y, w, h)
  n.tslfc+=1
end

function grounded(o)
  local v = mget(flr(o.x + 8) / 8, flr(o.y + 16) / 8)
  return fget(v, 0)
end

function drawtitlescreen()
		spr(129, 32, 16, 64, 64)
	 color(13)
	 print("press any button to start", 12, 64)
end
__gfx__
0000000000000000b3b3b3b3b3b3b3b3b3b3b3b04454444400000000000000000000000000000000000000000000000300000000000aaa000000000000000000
00000000000000003bbb3bbb3bbb3bbb3bbb3bb564444454000000000000000000000000000000000000000000000033b000000000aa9aa00000000000000000
007007000000000044444444444444444444443b4444444400000000000000000000003333000000000000000000003333000080000aaa000000000000000000
000770000000000045446440454464404544643b45446440000000000000000000300333b33000000000000003000003333303300b00b0000000000000000000
00077000000000004444444444444444444444b3444444440000000000000000033339333333000000000000003303333833330000bb00000000000000000000
007007000000000044444544444445444444453b444445440000000000000000003333333839000000000000003333b3333b3300000bb0000000000000000000
0000000000000000b3bb33bb40444444b3bb33bb40444444000000000000000000333b333b333000000000000003333333b33000000b00000000000000000000
00000000000000005b3bb5b3445444465b3bb5b04454444600000000000000000003833b33333300000000000000833333330000000b00000000000000000000
000000000000000003b3b3b333b3b330444444b303b3b3b300000000000000000000333333008000000000000000333333330330000000000000000000000000
00000000000000003bbb3bbbb33b33b3444544333bbb3bbb00000000000000000000040444004000000000000033003383003830000eee000000000000000000
0000000000000000bb4444444443443b644443b4bb44444400000000000000000000040440004000000000000033b33333333b30000e8e000000000000000000
0000000000000000b34464404454433344444433b344644000000000000000033000004440440000000000000033333333333300000eee000000000000000000
00000000000000003b444444044444b3444044b33b44444400000000000000383390000444000000000000000000338b333b3000000030000000000000000000
00000000000000003b44454444043433454444433b44454400000000000000333333000440000003330000000000033333330000000030000000000000000000
0000000000000000b3bb33bb454444bb44444b33b34544440000000000000033b834000440000033830000000000003333300000000030000000000000000000
00000000000000000b3bb5b3444644334464443b5b44443400000000000030033334400440000039330000000000004444400000000030000000000000000000
0000000000000000000000007767777703b3b3b0b344544400000000000033003330044440000044330000000000000000000000000000000000000000000000
000000000000000000000000777777673bbb3bb33b44443400000000000383330000000440000440000000000000000000000000000000000000000000000000
00000000000000000000000077777777bb44443bbb4444440000000000033b330000000440444000000000000000000000000000000000000000000000000000
00000000000000000000000077777577b34464bbb344644000000000000333390000000444400000000000000000000000760000000000000000000000000000
000000000000000000000000777777773b0444b33b44444400000000000333334000000444000000000000000000000007666000000000000000000000000000
000000000000000000000000767777773b44453b3b44454400000000003393304400000440000000030b00000007660000760000000000000000000000000000
00000000000000000000000077775777b3bb33bbb345444400000000000000000044000440000000333000000076666000000000000000000000000000000000
000000000000000000000000777777770b3bb5b05b44443400000000000000000004440440000000938300000076666000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000044440000000033300000076666607660000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000440000004430000000766666666666000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000440000044000000000766666666666600000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000440000444000000000766666666666660000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000444444004400000000076666666666600000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000440000000000000000007666666666000000000000000000000000000
000000fff00000000000000000000000000000000000000000000000000000000000000440000000000000000000000000000000000000000000000000000000
000000ffc00000000000000000000000000000000000000000000000000000000000000440000000000000000000000000000000000000000000000000000000
00000009999000000000000999900000000000099990000000000000000000000000000088880000000000000000000000000000000000000000000000000000
0000000f3f0000000000000f3f0000000000000f3f000000000000008888000000000000f3f00000000000008888000000000000000000000000000000000000
00000004ff00000000000004ff00000000000004ff00000000000000f3f00000000000004ff0000000000000f3f0000000000000000000000000000000000000
000000044400000000000004440000000000000444000000000000004ff000000f00000044400000000000004ff0000000000000000000000000000000000000
0000000ff00000000000000ff00000000000000ff00000000f0000004440000000880000f0000000000000004440000000000000000000000000000000000000
00000999999000000000099999900000000009999990000000880000f0000000000088888888800000000000f000000000000000000000000000000000000000
000090999909000000009099999000000000099999090000000088888888800000000088888008000f8888888888880000000000000000000000000000000000
0000909999090000000090999990000000000999990099f000000088888008000000008888800800000000888880008f00000000000000000000000000000000
000900999909000000009099999000000000009f99000000000000888880080000000088888000f0000000888880000000000000000000000000000000000000
000f0099990f00000000f09999f00000000000999900000000000088888000f00000008888800000000000888880000000000000000000000000000000000000
00000055550000000000005555000000000000555500000000000088888000000000005555500000000000888880000000000000000000000000000000000000
00000050050000000000005005000000000000500050000000000055555000000000050000050000000000555550000000000000000000000000000000000000
00000050050000000000005005000000000000500005000000000500000500000000500000005c00000005000005000000000000000000000000000000000000
00000050050000000004550005000000000000500005000000005000000050000000500000ccc00000c050000000500000000000000000000000000000000000
00000040044000000004000004000000000000440004400000c05000000050c00000500ccc000000000ccccccc0050c000000000000000000000000000000000
000000400000000000000000040000000000000000000000000ccccccccccc00000cccc0000000000000000000cccc0000000000000000000000000000000000
00000a0000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000aaa90000000000006006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000008a890005000000006666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000aaa9000a000000006c06000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000066a9000a000000006666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000a9000a0000050006886000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
005aaaaa9aaa00000006000660006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000a900000000000666666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000a900000000000006666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000aaa90000000000006666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000aaaaaa000000000006666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000aa00aa000000000006006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000a0000a000000000006006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000a0000a000000000006006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0005aaa00aaa50000000566056000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010101010000000000000000000000000101010000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000202020200000000000000000000000002020202000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000708090a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b0c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000001718191a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000708090a00000000000000001b1c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000002728292a0000000000000000000000000000000000000000000000000000000000000000000708090a00000000001718191a0000000000000012020400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000001d38393a0000000000000000000000000000000d0000000000000b0c0000000000000000001718191a00000000002728292a00000000000000000000000000000000000708090a0000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000012020204000000000000000000000708090a12040000000000001b1c0000000000000000002728292a00000000003738393a00001d00000000000000000000000000001718191a0000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000001718191a00000000000000120202040000000000000d003738393a00000000120202020202020400000000000000000000000000002728292a0000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000002728292a000000000000000000000000000000001202020202040000000000000000000000000000000000000000000000000000003738393a000d000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000b0c0000000000000000000000000000003738393a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012020202020204000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000001b1c0000000000000000000000000000120303030303040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000150313000708090a0000000000000000000000000000000000000708090a000000000000000000120400000000000000001d000d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000050505131718191a0000000d00000000000000000000000000001718191a00000000000000000000000000000000000012020204000700000000000000000000000000240000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000002728292a00000024000000000000000b0c00000000002728292a0000000000000000000000000b0c000000000000000000000000000000000b0c0000000000000000000000000000000000000000000b0c000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000003738393a00000000000000001d00001b1c000000001d3738393a0000001d0d0000000000000d1b1c000000000000000000000000001d00001b1c0000000000000000001d00000000000000000000001b1c000000000000000000000000000000000000000000000000
03030303030303030303030303030303030303030303030303030313000000000000150303030303030303030303030303130000120400001503030303030303030303030303030400001203030303030303030303030303030303030303130000000d0015030303030303030303030303030303030303030303030303030303
0505050505050505050505050505050505050505050505050505051400000000000025050505050505050505050505050514000000000000250505050505050505050505050505000000000505050505050505050505050505050505050514002400240025050505050505050505050505050505050505050505050505050505
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323
2323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323
